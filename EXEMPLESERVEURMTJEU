import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.PrintWriter;
import java.net.ServerSocket;
import java.net.Socket;

public class ServeurMT extends Thread {
	// DANS CE PROGRAMME ON VA CREER UN JEU, OU PLUSIEURS CLIENT JOUE POUR TROUVER UN NBR SECRET
	int nbJoueurs;
	//pour noter quel joueur cest
	private int nombreSecret; 
	private boolean fin;
	private String gagnant; 
	// ATTRIBUT COMMUN AU JOUEUR
	
	public void run() {
		try {
			ServerSocket ss = new ServerSocket(234);
			nombreSecret=(int)(Math.random()*1000);
			while(true) {
				Socket s=ss.accept();
				++nbJoueurs;
				new Conversation(s,nbJoueurs).start();
			}
		}catch (IOException e) {
			e.printStackTrace();
		}
	}//a chaque joueur en plus, le num du joueur connecté augmente 
	//ON SPECIFIE QUE LE NOMBRE SECRET EST COMPRIS ENTRE 0 ET 1000
	
	class Conversation extends Thread{
		private Socket socket;
		private int numeroJoueur;
		
		public Conversation (Socket socket, int num) {
			super();
			this.socket = socket; 
			this.numeroJoueur=num;
		} 
		
		public void run() {
			//code de la conv
			try {
				InputStream is = socket.getInputStream();
				InputStreamReader isr = new InputStreamReader(is);
				BufferedReader br = new BufferedReader(isr);
				
				OutputStream os = socket.getOutputStream();
				PrintWriter pw = new PrintWriter(os,true);
				
				String IP = socket.getRemoteSocketAddress().toString();
				
				System.out.println("Connexion du client numéro"+numeroJoueur+"IP="+IP);
				pw.println("Bienvenue, vous êtes le client numéro"+numeroJoueur);
				pw.println("Devinez un nombre entre 0 et 1000");
				
				while(true) {
					String req;
					while((req=br.readLine())!=null) {
						System.out.println(IP+"a envoyé"+req);
						int nb = Integer.parseInt(req); //rendre un int en caractère je crois 
						if (fin==false) {
							if (nb<nombreSecret) {
								pw.println("votre nombre est trop petit");
							}
							else if (nb>nombreSecret) {
								pw.println("votre nombre est trop grand");
							}
							else { 
								gagnant=IP;
								fin=true;
								pw.println("Bravo vous avez gagné...");
								System.out.println("BRAVO"+IP); 
							}
						}
						else {
							pw.println("le jeu est terminé, le gagnant est"+gagnant);	
						}
						String rep="Size="+req.length();
						pw.println(rep);
					}
				}//ici on renvoie le nombre de caractère de la phrase qu'a envoyé le joueur
				//+ on dit lorsque quelquun à gagner le jeu 
				
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
	}
	public static void main (String[] args) {
		new ServeurMT().start();
	}
}
